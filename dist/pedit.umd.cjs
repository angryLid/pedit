(function(l,o){typeof exports=="object"&&typeof module<"u"?o(exports,require("jszip"),require("fast-xml-parser")):typeof define=="function"&&define.amd?define(["exports","jszip","fast-xml-parser"],o):(l=typeof globalThis<"u"?globalThis:l||self,o(l.pedit={},l.JSZip,l.fastXmlParser))})(this,function(l,o,u){"use strict";const S=new u.XMLParser({ignoreAttributes:!1,isArray:n=>["p:sp","p:pic","p:graphicFrame","p:grpSp","c:ser","a:tr","a:tc"].indexOf(n)!==-1}),P=new u.XMLBuilder({ignoreAttributes:!1}),O=async(n,t)=>{const e=n.file(t);if(!e)throw new Error(`No such file: ${t}`);const s=await e.async("uint8array"),r=await o.loadAsync(s);return{async loadXml(i){return v(r,i)},async save(){const i=await r.generateAsync({type:"uint8array"});n.file(t,i)}}},v=async(n,t)=>{const e=n.file(t);if(!e)throw new Error(`No such file: ${t}`);const s=await e.async("string"),r=S.parse(s);return{get(){return r},modify(i){i(r);const a=P.build(r);n.file(t,a)}}},m=v,x=n=>n.replace(/(slide|chart)\d+\.xml/,t=>`_rels/${t}.rels`),y=n=>n.replace(/\.\./,"ppt");class C{constructor(t,e){this.ele=t,this.slide=e,this.shapeType="chart",this.id=t["p:nvGraphicFramePr"]["p:cNvPr"]["@_id"],this.name=t["p:nvGraphicFramePr"]["p:cNvPr"]["@_name"]}async setValue(t,e,s){var F;const r=this.ele["a:graphic"]["a:graphicData"]["c:chart"]["@_r:id"],i=x(this.slide.filename),a=this.slide.pptxFile.zip,c=(await m(a,i)).get().Relationships.Relationship.find(p=>p["@_Id"]===r);if(!c)throw new Error("relationship not found");const X=c["@_Target"],j=y(X),A=await m(a,j);A.modify(p=>{const f=p["c:chartSpace"]["c:chart"]["c:plotArea"];"c:pieChart"in f?f["c:pieChart"]["c:ser"][t-1]["c:val"]["c:numRef"]["c:numCache"]["c:pt"][e-1]["c:v"]=s:"c:lineChart"in f?f["c:lineChart"]["c:ser"][t-1]["c:val"]["c:numRef"]["c:numCache"]["c:pt"][e-1]["c:v"]=s:"c:barChart"in f&&(f["c:barChart"]["c:ser"][t-1]["c:val"]["c:numRef"]["c:numCache"]["c:pt"][e-1]["c:v"]=s)});const E=x(j),$=await m(a,E),I=A.get()["c:chartSpace"]["c:externalData"]["@_r:id"],T=(F=$.get().Relationships.Relationship.find(p=>p["@_Id"]===I))==null?void 0:F["@_Target"];if(!T)throw new Error("relationship not found");const M=y(T),z=await O(a,M);(await z.loadXml("xl/worksheets/sheet1.xml")).modify(p=>{p.worksheet.sheetData.row[t].c[e].v=s}),await z.save()}}class b{constructor(t){this.xmlObj=t,this.shapeType="text",this.id=t["p:nvSpPr"]["p:cNvPr"]["@_id"],this.name=t["p:nvSpPr"]["p:cNvPr"]["@_name"]}setText(t){Array.isArray(this.xmlObj["p:txBody"]["a:p"])&&(this.xmlObj["p:txBody"]["a:p"]=this.xmlObj["p:txBody"]["a:p"][0]),Array.isArray(this.xmlObj["p:txBody"]["a:p"]["a:r"])&&(this.xmlObj["p:txBody"]["a:p"]["a:r"]=this.xmlObj["p:txBody"]["a:p"]["a:r"][0]),this.xmlObj["p:txBody"]["a:p"]["a:r"]?this.xmlObj["p:txBody"]["a:p"]["a:r"]["a:t"]=t:this.xmlObj["p:txBody"]["a:p"]={"a:pPr":{"@_algn":"ctr"},"a:r":{"a:t":t,"a:rPr":{"@_kumimoji":"1","@_lang":"en-US","@_altLang":"zh-CN","@_dirty":"0"}}}}}class w{constructor(t){this.xmlObj=t,this.shapeType="group",this.id=t["p:nvGrpSpPr"]["p:cNvPr"]["@_id"],this.name=t["p:nvGrpSpPr"]["p:cNvPr"]["@_name"]}get children(){var s,r;const t=((s=this.xmlObj["p:sp"])==null?void 0:s.map(i=>new b(i)))||[],e=((r=this.xmlObj["p:grpSp"])==null?void 0:r.map(i=>new w(i)))||[];return{*[Symbol.iterator](){yield*[...t,...e]}}}}class B{constructor(t,e){this.ele=t,this.slide=e,this.shapeType="image",this.id=t["p:nvPicPr"]["p:cNvPr"]["@_id"],this.name=t["p:nvPicPr"]["p:cNvPr"]["@_name"]}async setImage(t){var d;const e=this.slide.pptxFile.zip,s=this.ele["p:blipFill"]["a:blip"]["@_r:embed"],r=x(this.slide.filename),a=(d=(await m(this.slide.pptxFile.zip,r)).get().Relationships.Relationship.find(c=>c["@_Id"]===s))==null?void 0:d["@_Target"];if(!a)throw new Error("target Not Found");const h=y(a);e.file(h,t),console.log("%c [imagePath]:","background:linear-gradient(#69c,#258, #69c);color:#fff;font-size:14px",h)}}class R{constructor(t){this.ele=t,this.shapeType="table",this.id=t["p:nvGraphicFramePr"]["p:cNvPr"]["@_id"],this.name=t["p:nvGraphicFramePr"]["p:cNvPr"]["@_name"]}get children(){return this.ele["a:graphic"]["a:graphicData"]["a:tbl"]["a:tr"],{*[Symbol.iterator](){yield new Number(2)}}}getCells(){const t=this.ele["a:graphic"]["a:graphicData"]["a:tbl"],e=[];for(let s=0;s<t["a:tr"].length;s++){const r=[];for(let i=0;i<t["a:tr"][s]["a:tc"].length;i++){const a=t["a:tr"][s]["a:tc"][i];a["@_vMerge"]?r.push(t["a:tr"][s-a["@_vMerge"]]["a:tc"][i]):a["@_hMerge"]?r.push(t["a:tr"][s]["a:tc"][i-a["@_hMerge"]]):r.push(a)}e.push(r)}return e}setValue(t,e,s){const i=this.getCells()[t-1][e-1]["a:txBody"];Array.isArray(i["a:p"])&&(i["a:p"]=i["a:p"][0]);const a=i["a:p"];Array.isArray(a["a:r"])&&(a["a:r"]=a["a:r"][0]),a["a:r"]&&(a["a:r"]["a:t"]=s.toString())}}class _{constructor(t,e,s){this.filename=e,this.pptxFile=s;const r=S.parse(t);this.xmlObj=r}*[Symbol.iterator](){var i,a,h,d;const t=((i=this.xmlObj["p:sld"]["p:cSld"]["p:spTree"]["p:sp"])==null?void 0:i.map(c=>new b(c)))||[],e=((a=this.xmlObj["p:sld"]["p:cSld"]["p:spTree"]["p:grpSp"])==null?void 0:a.map(c=>new w(c)))||[],s=((h=this.xmlObj["p:sld"]["p:cSld"]["p:spTree"]["p:graphicFrame"])==null?void 0:h.map(c=>"c:chart"in c["a:graphic"]["a:graphicData"]?new C(c,this):new R(c)))||[],r=((d=this.xmlObj["p:sld"]["p:cSld"]["p:spTree"]["p:pic"])==null?void 0:d.map(c=>new B(c,this)))||[];yield*[...t,...e,...s,...r]}getShapeById(t){throw new Error(t.toString())}generateXmlString(){return P.build(this.xmlObj)}}class g{constructor(t){this.modifiedSlides=new Set,this.zip=t}static async loadAsync(...t){const e=await o.loadAsync(...t);return new g(e)}async getSlide(t){if(t<1||t>2e3||Number.isNaN(t)||t.toString().includes("."))throw new Error("Page number is invalid.");try{const s=this.zip.file(`ppt/slides/slide${t}.xml`);if(!s)throw new Error(`Page ${t} doesn't exists.`);const r=await s.async("string"),i=new _(r,`ppt/slides/slide${t}.xml`,this);return this.modifiedSlides.add(i),i}catch{throw new Error(`Page ${t} doesn't exists.`)}}async getChart(t){if(t<1||t>2e3||Number.isNaN(t)||t.toString().includes("."))throw new Error("Page number is invalid.");try{const s=this.zip.file(`ppt/charts/chart${t}.xml`);if(!s)throw new Error(`Page ${t} doesn't exists.`);const r=await s.async("string"),i=new _(r,`ppt/slides/slide${t}.xml`,this);return this.modifiedSlides.add(i),i}catch{throw new Error(`Page ${t} doesn't exists.`)}}}g.prototype.generateAsync=function(...n){const t=this.zip;for(const e of this.modifiedSlides){const s=e.generateXmlString();t.file(e.filename,s)}return t.generateAsync(...n)},l.PptxFile=g,Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});
